#!/usr/bin/with-contenv bashio
# ==============================================================================
# radicale addon
# ==============================================================================
declare -a options

bashio::log.info "Starting nginx in radicale Addon ..."

envsubst '$SUPERVISOR_TOKEN' < /etc/nginx/conf.d/default.template > /etc/nginx/conf.d/default.conf || exit 1

if [ -d "/share/chisel/nginx/locations/" ]; then
    envsubst '${HOSTNAME}' < "/etc/chisel/radicale.conf" > "/share/chisel/nginx/locations/radicale.conf" || exit 1
fi

NGINX_PROXY_FILE="/share/nginx_proxy_default_radicale.conf"

envsubst '${HOSTNAME}' < "/etc/chisel/radicale.conf" > "${NGINX_PROXY_FILE}" || exit 1

exec nginx -g 'daemon off;' 2>&1

